---
language: python

arch: arm64-graviton2
dist: focal
os: linux
python: 3.8.6
virt: vm

cache:
  directories:
    - /home/travis/.rvm
    - /home/travis/.cache/pip
    - /home/travis/virtualenv

# Install ansible
install:
  - bundle install
  - pip uninstall --yes ansible
  - pip install -Ur requirements-latest.txt
  - pip freeze

script:
  - echo "$DOCKER_PASSWORD" | docker login -u "$DOCKER_USERNAME" --password-stdin
  - bundle exec rubocop -ES
  - molecule test --scenario-name latest --destroy never

notifications:
  webhooks:
    urls:
      - https://galaxy.ansible.com/api/v1/notifications/
      - https://webhooks.gitter.im/e/eee7ec1dcb85c454573a
    on_success: change  # options: [always|never|change] default: always
    on_failure: always  # options: [always|never|change] default: always
    on_start: never     # options: [always|never|change] default: always

jobs:
  include:
    - env: COMMAND="/usr/sbin/init"
           DISTRO="centos"
           TAG=latest
    - env: DISTRO="debian"
           TAG=stable
    - env: COMMAND="/usr/sbin/init"
           DISTRO="fedora"
           TAG=latest
    - env: DISTRO="ubuntu"
           TAG=latest
