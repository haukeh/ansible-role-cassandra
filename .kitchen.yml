driver:
  name: docker
  use_sudo: false

platforms:
- name: centos-7
  driver_config:
    run_command: /usr/sbin/init
    privileged: true
    platform: centos
    provision_command:
    - yum install -y epel-release
    - yum-config-manager --add-repo https://releases.ansible.com/ansible/rpm/release/epel-7-x86_64 ansible
    - rpm --import https://releases.ansible.com/keys/RPM-GPG-KEY-ansible-release.pub
    - yum install -y ansible-2.6.0 initscripts rsyslog
    - sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config
    - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
    - sed -i 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
    - sed -i 's/#LogLevel INFO/LogLevel DEBUG/g' /etc/ssh/sshd_config
    - systemctl enable rsyslog.service
    - systemctl enable sshd.service

- name: debian-9
  driver_config:
    platform: debian
    provision_command:
    - apt-get install -y apt-utils libffi-dev python-pycparser python-apt python-dev python-pip
    - pip install ansible==2.6.0.0

- name: fedora-28
  driver_config:
    image: fedora:28
    run_command: /usr/sbin/init
    privileged: true
    provision_command:
    - dnf install -y rsyslog iproute initscripts
    - pip3 install ansible==2.6.0.0
    - alternatives --install /usr/bin/python python /usr/bin/python3 2
    - sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config
    - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
    - sed -i 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
    - sed -i 's/#LogLevel INFO/LogLevel DEBUG/g' /etc/ssh/sshd_config
    - systemctl enable rsyslog.service
    - systemctl enable sshd.service

- name: fedora-29
  driver_config:
    image: fedora:29
    run_command: /usr/sbin/init
    privileged: true
    provision_command:
    - mkdir -p /var/run/cassandra
    - dnf clean all
    - dnf install -y rsyslog iproute initscripts java-1.8.0-openjdk-headless
    - pip3 install ansible==2.6.0.0
    - alternatives --install /usr/bin/python python /usr/bin/python3 2
    - sed -i 's/#UseDNS yes/UseDNS no/g' /etc/ssh/sshd_config
    - sed -i 's/UsePAM yes/UsePAM no/g' /etc/ssh/sshd_config
    - sed -i 's/GSSAPIAuthentication yes/GSSAPIAuthentication no/g' /etc/ssh/sshd_config
    - sed -i 's/#LogLevel INFO/LogLevel DEBUG/g' /etc/ssh/sshd_config
    - systemctl enable rsyslog.service
    - systemctl enable sshd.service

- name: ubuntu-16.04
  driver_config:
    platform: ubuntu
    provision_command:
    - apt-get install -y apt-utils libffi-dev python-pycparser python-apt python-dev python-pip
    - pip install ansible==2.6.0.0

- name: ubuntu-18.04
  driver_config:
    platform: ubuntu
    provision_command:
    - mkdir -p /var/run/sshd
    - apt-get install -y apt-utils iproute2 libffi-dev python-pycparser python-apt python-dev python-pip
    - pip install ansible==2.6.0.0

provisioner:
  additional_copy_path:
  - test
  ansible_inventory: test/inventory
  ansible_verbose: true
  ansible_verbosity: 3
  hosts: all
  name: ansible_playbook
  require_ansible_repo: false
  require_chef_for_busser: false
  require_chef_omnibus: false
  require_pip: false
  role_name: cassandra

verifier:
  name: inspec

suites:
- name: default
  provisioner:
    idempotency_test: true
    playbook: test/test.yml

- name: check
  provisioner:
    ansible_check: true
    playbook: test/test.yml
